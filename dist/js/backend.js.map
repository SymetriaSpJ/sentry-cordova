{"version":3,"file":"backend.js","sourceRoot":"","sources":["../../src/js/backend.ts"],"names":[],"mappings":"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","sourcesContent":["import { BrowserBackend, BrowserOptions } from '@sentry/browser';\nimport { BaseBackend } from '@sentry/core';\nimport { Scope } from '@sentry/hub';\nimport { Breadcrumb, SentryEvent, SentryEventHint, SentryResponse, Severity, Status } from '@sentry/types';\n\nconst PLUGIN_NAME = 'Sentry';\n\n/**\n * Configuration options for the Sentry Cordova SDK.\n * @see CordovaFrontend for more information.\n */\nexport interface CordovaOptions extends BrowserOptions {}\n\n/** The Sentry Cordova SDK Backend. */\nexport class CordovaBackend extends BaseBackend<BrowserOptions> {\n  private browserBackend: BrowserBackend;\n\n  private deviceReadyCallback: any;\n\n  /** Creates a new cordova backend instance. */\n  public constructor(options: CordovaOptions = {}) {\n    super(options);\n    this.browserBackend = new BrowserBackend(options);\n  }\n\n  /**\n   * @inheritDoc\n   */\n  public install(): boolean {\n    this.browserBackend.install();\n\n    if (this.isCordova()) {\n      this.deviceReadyCallback = () => this.runNativeInstall();\n      document.addEventListener('deviceready', this.deviceReadyCallback);\n    }\n\n    return true;\n  }\n\n  /**\n   * @inheritDoc\n   */\n  public async eventFromException(exception: any, hint?: SentryEventHint): Promise<SentryEvent> {\n    return this.browserBackend.eventFromException(exception, hint);\n  }\n\n  /**\n   * @inheritDoc\n   */\n  public async eventFromMessage(\n    message: string,\n    level: Severity = Severity.Info,\n    hint?: SentryEventHint\n  ): Promise<SentryEvent> {\n    return this.browserBackend.eventFromMessage(message, level, hint);\n  }\n\n  /**\n   * @inheritDoc\n   */\n  public async sendEvent(event: SentryEvent): Promise<SentryResponse> {\n    try {\n      await this.nativeCall('sendEvent', event);\n      // Otherwise this is from native response\n      return { status: Status.Success };\n    } catch (e) {\n      return this.browserBackend.sendEvent(event);\n    }\n  }\n\n  // CORDOVA --------------------\n  public nativeCall(action: string, ...args: any[]): Promise<any> {\n    return new Promise((resolve, reject) => {\n      const exec = window && (window as any).Cordova && (window as any).Cordova.exec;\n      if (!exec) {\n        reject('Cordova.exec not available');\n      } else {\n        (window as any).Cordova.exec(resolve, reject, PLUGIN_NAME, action, args);\n      }\n    });\n  }\n\n  private runNativeInstall(): void {\n    document.removeEventListener('deviceready', this.deviceReadyCallback);\n    if (this.options.dsn && this.options.enabled !== false) {\n      this.nativeCall('install', this.options.dsn, this.options);\n    }\n  }\n\n  private isCordova(): boolean {\n    return window.cordova !== undefined || window.Cordova !== undefined;\n  }\n\n  /**\n   * @inheritDoc\n   */\n  public storeBreadcrumb(breadcrumb: Breadcrumb): boolean {\n    this.nativeCall('addBreadcrumb', breadcrumb).catch(() => {\n      // We do nothing since all breadcrumbs are attached in the event.\n      // This only applies to android.\n    });\n    return true;\n  }\n\n  /**\n   * @inheritDoc\n   */\n  public storeScope(scope: Scope): void {\n    this.nativeCall('setExtraContext', (scope as any).extra).catch(() => {\n      // We do nothing since scope is handled and attached to the event.\n      // This only applies to android.\n    });\n    this.nativeCall('setTagsContext', (scope as any).tags).catch(() => {\n      // We do nothing since scope is handled and attached to the event.\n      // This only applies to android.\n    });\n    this.nativeCall('setUserContext', (scope as any).user).catch(() => {\n      // We do nothing since scope is handled and attached to the event.\n      // This only applies to android.\n    });\n  }\n}\n"]}